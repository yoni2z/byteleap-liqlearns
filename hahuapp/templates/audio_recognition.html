{% extends "base.html" %} {% block content %}
<div class="d-flex justify-content-center">
  <div class="text-center">
    <h2>Audio Recognition Game</h2>
    <p>Listen to the audio and type the first letter of the word you hear:</p>

    <!-- Audio Player -->
    <audio controls class="my-3">
      <source src="{{ word_audio.audio_file.url }}" type="audio/mpeg" />
      Your browser does not support the audio element.
    </audio>

    <!-- User Input -->
    <input
      type="text"
      id="user-input"
      class="form-control mb-2"
      placeholder="Type the first letter"
      maxlength="1"
    />

    <button
      class="btn mt-2"
      onclick="checkAnswer()"
      style="background: linear-gradient(to bottom, #ffefd5, #ffe4b5)"
    >
      Submit
    </button>

    <button
      id="try-again-button"
      class="btn btn-warning mt-2"
      style="display: none"
      onclick="tryAgain()"
    >
      Try Again
    </button>

    <a
      href="{% url 'letter-quiz' %}"
      id="continue-button"
      class="btn btn-success mt-2"
      style="display: none"
    >
      Continue
    </a>

    <p id="feedback" class="mt-3"></p>
  </div>
</div>

<script>
  let attemptsLeft = 3; // Track attempts

  function checkAnswer() {
    const userInput = document.getElementById("user-input");
    const feedback = document.getElementById("feedback");
    const correctAnswers =
      "{{ word_audio.acceptable_characters }}".toLowerCase(); // Get acceptable characters
    const tryAgainButton = document.getElementById("try-again-button");
    const continueButton = document.getElementById("continue-button");

    // Clear previous highlights
    userInput.classList.remove("is-invalid", "is-valid");

    const userGuess = userInput.value.trim().toLowerCase();

    // Check if the user input matches any acceptable character
    if (correctAnswers.includes(userGuess)) {
      feedback.textContent = "Correct! ðŸŽ‰";
      feedback.style.color = "green";
      userInput.classList.add("is-valid"); // Success highlight
      userInput.disabled = true; // Disable input on correct answer
      continueButton.style.display = "block"; // Show Continue button
      tryAgainButton.style.display = "none"; // Hide Try Again button
    } else {
      attemptsLeft--; // Decrease attempts for incorrect answer

      if (attemptsLeft > 0) {
        feedback.textContent = `Incorrect! You have ${attemptsLeft} tries left.`;
        feedback.style.color = "red";
        userInput.classList.add("is-invalid"); // Error highlight
      } else {
        feedback.textContent = `Incorrect! The correct answer is one of: "${correctAnswers}".`;
        feedback.style.color = "red";
        userInput.classList.add("is-invalid"); // Error highlight
        userInput.disabled = true; // Disable input on max attempts
        tryAgainButton.style.display = "block"; // Show Try Again button
        continueButton.style.display = "none"; // Hide Continue button
      }
    }
  }

  function tryAgain() {
    location.reload(); // Reload the page to start fresh
  }
</script>

{% endblock %}
