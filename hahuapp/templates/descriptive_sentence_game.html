{% extends 'base.html' %} {% block content %}
<div class="container my-5">
  <h2>Descriptive Sentence Game</h2>
  <div class="text-center">
    <img
      src="{{ question.image.url }}"
      alt="Descriptive Image"
      class="img-fluid my-4"
      style="max-width: 400px"
      id="question-image"
    />

    <!-- Input field for descriptive sentence -->
    <input
      type="text"
      id="answer"
      class="form-control my-3"
      placeholder="Type a sentence that describes the image"
    />

    <!-- Submit and next question buttons -->
    <button
      id="submit-answer"
      class="btn"
      style="background: linear-gradient(to bottom, #ffefd5, #ffe4b5)"
    >
      Submit Answer
    </button>
    <button id="next-question" class="btn btn-secondary d-none">
      Next Question
    </button>

    <p id="response-message" class="mt-3"></p>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function () {
    let questionId = "{{ question.id }}"; // Get current question ID

    $("#submit-answer").on("click", function () {
      let userAnswer = $("#answer").val().trim(); // Get user input answer

      // Ensure an answer has been provided
      if (userAnswer === "") {
        alert("Please enter an answer.");
        return;
      }

      // Send AJAX request to check the answer
      $.ajax({
        url: "", // Current page URL
        type: "POST",
        data: {
          answer: userAnswer,
          question_id: questionId, // Send current question ID
          csrfmiddlewaretoken: "{{ csrf_token }}",
        },
        success: function (response) {
          // Update response message based on answer
          $("#response-message").text(response.message);

          // If correct, show next question button and hide submit button
          if (response.is_correct) {
            $("#response-message")
              .removeClass("text-danger")
              .addClass("text-success");
            $("#next-question").removeClass("d-none"); // Show next question button
            $("#submit-answer").addClass("d-none"); // Hide submit button

            // Update the image and question ID for the next round
            $("#question-image").attr("src", response.new_question_image_url);
            questionId = response.new_question_id; // Update the question ID for the next round
          } else {
            $("#response-message")
              .removeClass("text-success")
              .addClass("text-danger");
          }
        },
        error: function (xhr, status, error) {
          console.error("AJAX error:", status, error); // Log AJAX errors
          alert("There was an error processing your request.");
        },
      });
    });

    $("#next-question").on("click", function () {
      // Reload the game with a new question without refreshing the page
      $.ajax({
        url: "", // Same URL to fetch a new question
        type: "GET",
        success: function (response) {
          // Update the question and image
          $("#question-image").attr("src", response.new_question_image_url);
          $("#answer").val(""); // Clear the input field
          questionId = response.new_question_id; // Update the question ID for the next round

          // Reset the buttons for the next round
          $("#submit-answer").removeClass("d-none");
          $("#next-question").addClass("d-none");
          $("#response-message").text("");
        },
        error: function (xhr, status, error) {
          console.error("AJAX error:", status, error);
          alert("There was an error loading the new question.");
        },
      });
    });
  });
</script>
{% endblock %}
